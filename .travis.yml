dist: trusty
sudo: false
addons:
  firefox: "58.0.1"
  chrome: stable
  apt:
    packages:
      - xvfb
      - libexif-dev
      - udev
language: node_js
node_js:
  - "9"
os:
  - linux
cache: yarn
before_install:
  # Use a virtual display.
  - "export DISPLAY=:99.0"
  - "/sbin/start-stop-daemon --start --quiet --pidfile /tmp/custom_xvfb_99.pid --make-pidfile --background --exec /usr/bin/Xvfb -- :99 -ac -screen 0 1920x1080x16"
  # Install latest chrome.
  - export CHROME_BIN=google-chrome-stable
  # Use newer Yarn version
  - curl -o- -L https://yarnpkg.com/install.sh | bash -s -- --version 1.6.0
  - export PATH="$HOME/.yarn/bin:$PATH"
  - google-chrome-stable --version
  - which google-chrome-stable
install:
  - yarn install
script:
  - npm run lint
  - npm run test:once
  - npm run integration
  - npm run coverage

# deployment
after_success:
  - cd dist/
deploy:
  skip_cleanup: true # stay in working dir (dist/)
  provider: npm
  email: service.eng@akquinet.de
  api_key:
    secure: "ViDG1rmqZXFEnkVOtztIE0tTcgsMRgbO4QC3soKRiJMp8hbwPdbEOJ4/n899fXJUGNTWsq1jSFoY5vG+mRwf/OEKeJ/2iz34gDXwEsD2QjeYGxnbWJJCOVaWWF5+E5VzEg/FqF8QNH4OWEVg3u7hD1/6opgBG14KxEzBDEbqYAI8KPwwMpxHcOA1/evYu8Gi0OqrVETmpKQCWtE5Nka7suSjtgAbize0zUHn8DIf4wShkSkjXrTlFiNevMQBYf2ZLfmK/qU9s15wYhDAz/bAzHdZhtj7O+fn+uJh9r004TFgPshToLjDXRKgDILDAumb2E8V4ISOdDrbPVLAxvjf+TbHiivAkd80HDe8bupR8lYs7Zhs6nhD8Gog5dTpOsmuK/S57fYKPZnZ4VlzPBQni+LmSeCxLed3EB6qANRZv27Br46bp4olJzAxdAlTiCJ2iCzOBwmKYmzbAIDd70+GgAzAMxGwKXE7T1m+UERg+B1ucQA0bNhBqOm+nogjfJ9bYpTSg1tCm+0UEA0zCHQe8nP6SaMn6SeVoxjTu+AjjCafy3HDnrv8gUenK/X7HRnwefQaCtIt3c7pizTldlws9foUtBubcqLfqdjUcvf8a01xYxQaEQSvq9UnZzuK4hwGJ8I7LuR+1mE8WL8U3hccDcmIhSeyYguk6um+jp6xWjc="
  on:
    condition: "$FIREFOX_VERSION = latest"
    tags: true
    repo: test-editor/web-messaging-service
    node: "9"
